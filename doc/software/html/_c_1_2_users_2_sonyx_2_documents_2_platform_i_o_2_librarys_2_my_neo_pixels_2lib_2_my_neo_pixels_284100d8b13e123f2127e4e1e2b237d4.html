<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MyAvr: C:/Users/Sonyx/Documents/PlatformIO/Librarys/MyNeoPixels/lib/MyNeoPixels/src/MyWS2812B.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MyAvr<span id="projectnumber">&#160;1.0.1</span>
   </div>
   <div id="projectbrief">The library simplifies LED programming on avr controller</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_c_1_2_users_2_sonyx_2_documents_2_platform_i_o_2_librarys_2_my_neo_pixels_2lib_2_my_neo_pixels_284100d8b13e123f2127e4e1e2b237d4.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">C:/Users/Sonyx/Documents/PlatformIO/Librarys/MyNeoPixels/lib/MyNeoPixels/src/MyWS2812B.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>Sets the given LED array with standard RGB values.</p>
<p>Sets the given LED array with standard RGB values.</p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">led_array</td><td>The array of <a class="el" href="structpod__rgb.html" title="Structure of the LED array.">pod_rgb</a> values for the LEDs. </td></tr>
    <tr><td class="paramname">number_of_leds</td><td>The number of LEDs to control.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>This method may result in unexpected behavior and should be used with caution.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The function sets the LED array using setLedsPin() with the data output pin for the LEDs.</dd></dl>
<p><a class="el" href="class_my_w_s2812_b.html">MyWS2812B</a> ws2812; struct <a class="el" href="structpod__rgb.html" title="Structure of the LED array.">pod_rgb</a> leds[2] = {{255, 0, 0}, {0, 255, 0}}; ws2812.setLeds(leds, 2);</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;MyWS2812B.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// BELOW THIS SECTION IS THE MAGIC</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Normally sendArrayMask() runs under disabled-interrupt condition,</span></div>
<div class="line"><span class="comment">// undefine if you want to accept interrupts in that function.</span></div>
<div class="line"><span class="preprocessor">#define interrupt_is_disabled</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <span class="keyword">inline</span> MyWS2812B ::setLeds(<a id="_a0" name="_a0"></a><a class="code hl_struct" href="structpod__rgb.html">pod_rgb</a>  *led_array, uint16_t number_of_leds) {</div>
<div class="line"> </div>
<div class="line">  setLedsPin(led_array, number_of_leds, 1 &lt;&lt; (pin_));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <span class="keyword">inline</span> MyWS2812B ::setLedsPin(<a class="code hl_struct" href="structpod__rgb.html">pod_rgb</a> *led_array, uint16_t leds, uint8_t pin_mask) {</div>
<div class="line"> </div>
<div class="line">  sendArrayMask((uint8_t*)led_array, leds + leds + leds, pin_mask);</div>
<div class="line">  _delay_us(TIME_RESET);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyWS2812B ::sendArray(uint8_t *data,uint16_t data_len) {</div>
<div class="line"> </div>
<div class="line">  sendArrayMask(data, data_len, 1 &lt;&lt; (pin_));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Timing in ns</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define w_zeropulse   350</span></div>
<div class="line"><span class="preprocessor">#define w_onepulse    900</span></div>
<div class="line"><span class="preprocessor">#define w_totalperiod 1250</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Fixed cycles used by the inner loop</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if defined(__LGT8F__)</span></div>
<div class="line"><span class="preprocessor">#define w_fixedlow    4</span></div>
<div class="line"><span class="preprocessor">#define w_fixedhigh   6</span></div>
<div class="line"><span class="preprocessor">#define w_fixedtotal  10   </span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#define w_fixedlow    3</span></div>
<div class="line"><span class="preprocessor">#define w_fixedhigh   6</span></div>
<div class="line"><span class="preprocessor">#define w_fixedtotal  10   </span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Insert NOPs to match the timing, if possible</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define w_zerocycles    (((F_CPU/1000)*w_zeropulse          )/1000000)</span></div>
<div class="line"><span class="preprocessor">#define w_onecycles     (((F_CPU/1000)*w_onepulse    +500000)/1000000)</span></div>
<div class="line"><span class="preprocessor">#define w_totalcycles   (((F_CPU/1000)*w_totalperiod +500000)/1000000)</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// w1 - nops between rising edge and falling edge - low</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define w1 (w_zerocycles-w_fixedlow)</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// w2   nops between fe low and fe high</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define w2 (w_onecycles-w_fixedhigh-w1)</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// w3   nops to complete loop</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define w3 (w_totalcycles-w_fixedtotal-w1-w2)</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if w1&gt;0</span></div>
<div class="line"><span class="preprocessor">  #define w1_nops w1</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">  #define w1_nops  0</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// The only critical timing parameter is the minimum pulse length of the &quot;0&quot;</span></div>
<div class="line"><span class="comment">// Warn or throw error if this timing can not be met with current F_CPU settings.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define w_lowtime ((w1_nops+w_fixedlow)*1000000)/(F_CPU/1000)</span></div>
<div class="line"><span class="preprocessor">#if w_lowtime&gt;550</span></div>
<div class="line"><span class="preprocessor">   #error &quot;Light_ws2812: Sorry, the clock speed is too low. Did you set F_CPU correctly?&quot;</span></div>
<div class="line"><span class="preprocessor">#elif w_lowtime&gt;450</span></div>
<div class="line"><span class="preprocessor">   #warning &quot;Light_ws2812: The timing is critical and may only work on WS2812B, not on WS2812(S).&quot;</span></div>
<div class="line"><span class="preprocessor">   #warning &quot;Please consider a higher clockspeed, if possible&quot;</span></div>
<div class="line"><span class="preprocessor">#endif   </span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if w2&gt;0</span></div>
<div class="line"><span class="preprocessor">#define w2_nops w2</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#define w2_nops  0</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if w3&gt;0</span></div>
<div class="line"><span class="preprocessor">#define w3_nops w3</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#define w3_nops  0</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define w_nop1  &quot;nop      \n\t&quot;</span></div>
<div class="line"><span class="preprocessor">#ifdef interrupt_is_disabled</span></div>
<div class="line"><span class="preprocessor">#define w_nop2  &quot;brid .+0 \n\t&quot;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#define w_nop2  &quot;brtc .+0 \n\t&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#define w_nop4  w_nop2 w_nop2</span></div>
<div class="line"><span class="preprocessor">#define w_nop8  w_nop4 w_nop4</span></div>
<div class="line"><span class="preprocessor">#define w_nop16 w_nop8 w_nop8</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <span class="keyword">inline</span> MyWS2812B ::sendArrayMask(uint8_t *data, uint16_t data_len, uint8_t maskhi) {</div>
<div class="line"> </div>
<div class="line">  uint8_t curbyte, ctr, masklo;</div>
<div class="line">  uint8_t sregPrev;</div>
<div class="line"> </div>
<div class="line">  uint8_t *port = ptrPortRegisterMemAddr_;</div>
<div class="line">  </div>
<div class="line">  (*ptrDataDirectionRegister_) |= maskhi; <span class="comment">// Enable output</span></div>
<div class="line">  </div>
<div class="line">  masklo    = ~maskhi &amp; (*ptrPortRegister_);</div>
<div class="line"> </div>
<div class="line">  maskhi |= (*ptrPortRegister_);</div>
<div class="line">  </div>
<div class="line">  sregPrev=SREG;</div>
<div class="line"><span class="preprocessor">#ifdef interrupt_is_disabled</span></div>
<div class="line">  cli();  </div>
<div class="line"><span class="preprocessor">#endif  </span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span> (data_len--) {</div>
<div class="line"> </div>
<div class="line">    curbyte=*data++;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">asm</span> <span class="keyword">volatile</span>(</div>
<div class="line">    <span class="stringliteral">&quot;       ldi   %0,8  \n\t&quot;</span></div>
<div class="line"><span class="preprocessor">#ifndef interrupt_is_disabled</span></div>
<div class="line">    <span class="stringliteral">&quot;       clt         \n\t&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="stringliteral">&quot;loop%=:            \n\t&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;       st    X,%3 \n\t&quot;</span>    <span class="comment">//  &#39;1&#39; [02] &#39;0&#39; [02] - re</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if (w1_nops&amp;1)</span></div>
<div class="line">w_nop1</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w1_nops&amp;2)</span></div>
<div class="line">w_nop2</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w1_nops&amp;4)</span></div>
<div class="line">w_nop4</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w1_nops&amp;8)</span></div>
<div class="line">w_nop8</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w1_nops&amp;16)</span></div>
<div class="line">w_nop16</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if defined(__LGT8F__)</span></div>
<div class="line">    <span class="stringliteral">&quot;       bst   %1,7  \n\t&quot;</span>    <span class="comment">//  &#39;1&#39; [02] &#39;0&#39; [02]</span></div>
<div class="line">    <span class="stringliteral">&quot;       brts  1f    \n\t&quot;</span>    <span class="comment">//  &#39;1&#39; [04] &#39;0&#39; [03]</span></div>
<div class="line">    <span class="stringliteral">&quot;       st    X,%4  \n\t&quot;</span>    <span class="comment">//  &#39;1&#39; [--] &#39;0&#39; [04] - fe-low</span></div>
<div class="line">    <span class="stringliteral">&quot;1:     lsl   %1    \n\t&quot;</span>    <span class="comment">//  &#39;1&#39; [05] &#39;0&#39; [05]</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <span class="stringliteral">&quot;       sbrs  %1,7  \n\t&quot;</span>    <span class="comment">//  &#39;1&#39; [04] &#39;0&#39; [03]</span></div>
<div class="line">    <span class="stringliteral">&quot;       st    X,%4 \n\t&quot;</span>     <span class="comment">//  &#39;1&#39; [--] &#39;0&#39; [05] - fe-low</span></div>
<div class="line">    <span class="stringliteral">&quot;       lsl   %1    \n\t&quot;</span>    <span class="comment">//  &#39;1&#39; [05] &#39;0&#39; [06]</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w2_nops&amp;1)</span></div>
<div class="line">  w_nop1</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w2_nops&amp;2)</span></div>
<div class="line">  w_nop2</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w2_nops&amp;4)</span></div>
<div class="line">  w_nop4</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w2_nops&amp;8)</span></div>
<div class="line">  w_nop8</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w2_nops&amp;16)</span></div>
<div class="line">  w_nop16 </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="stringliteral">&quot;       brcc skipone%= \n\t&quot;</span>    <span class="comment">//  &#39;1&#39; [+1] &#39;0&#39; [+2] - </span></div>
<div class="line">    <span class="stringliteral">&quot;       st   X,%4      \n\t&quot;</span>    <span class="comment">//  &#39;1&#39; [+3] &#39;0&#39; [--] - fe-high</span></div>
<div class="line">    <span class="stringliteral">&quot;skipone%=:               &quot;</span>     <span class="comment">//  &#39;1&#39; [+3] &#39;0&#39; [+2] - </span></div>
<div class="line"><span class="preprocessor">#if (w3_nops&amp;1)</span></div>
<div class="line">w_nop1</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w3_nops&amp;2)</span></div>
<div class="line">w_nop2</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w3_nops&amp;4)</span></div>
<div class="line">w_nop4</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w3_nops&amp;8)</span></div>
<div class="line">w_nop8</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if (w3_nops&amp;16)</span></div>
<div class="line">w_nop16</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="stringliteral">&quot;       dec   %0    \n\t&quot;</span>    <span class="comment">//  &#39;1&#39; [+4] &#39;0&#39; [+3]</span></div>
<div class="line">    <span class="stringliteral">&quot;       brne  loop%=\n\t&quot;</span>    <span class="comment">//  &#39;1&#39; [+5] &#39;0&#39; [+4]</span></div>
<div class="line">    :   <span class="stringliteral">&quot;=&amp;d&quot;</span> (ctr)</div>
<div class="line">    :   <span class="stringliteral">&quot;r&quot;</span> (curbyte), <span class="stringliteral">&quot;x&quot;</span> (port), <span class="stringliteral">&quot;r&quot;</span> (maskhi), <span class="stringliteral">&quot;r&quot;</span> (masklo)</div>
<div class="line">    );</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  SREG = sregPrev;</div>
<div class="line"><span class="preprocessor">#ifdef interrupt_is_disabled</span></div>
<div class="line">  sei();  <span class="comment">// enable after the magic happend</span></div>
<div class="line"><span class="preprocessor">#endif  </span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// ABOVE THIS SECTION IS THE MAGIC</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> MyWS2812B ::calculateBrightness (uint8_t bright, uint8_t led) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> percent = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(DIM_CURVE[bright]) / 255;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (colorMapping_) {</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> RGB:</div>
<div class="line"> </div>
<div class="line">      colorMapped_[led].r = color_[led].r * percent;</div>
<div class="line">      colorMapped_[led].g = color_[led].g * percent;</div>
<div class="line">      colorMapped_[led].b = color_[led].b * percent;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> RBG:</div>
<div class="line"> </div>
<div class="line">      colorMapped_[led].r = color_[led].r * percent;</div>
<div class="line">      colorMapped_[led].b = color_[led].g * percent;</div>
<div class="line">      colorMapped_[led].g = color_[led].b * percent;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">      </div>
<div class="line">    <span class="keywordflow">case</span> GRB:</div>
<div class="line"> </div>
<div class="line">      colorMapped_[led].g = color_[led].r * percent;</div>
<div class="line">      colorMapped_[led].r = color_[led].g * percent;</div>
<div class="line">      colorMapped_[led].b = color_[led].b * percent;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> GBR:</div>
<div class="line"> </div>
<div class="line">      colorMapped_[led].g = color_[led].r * percent;</div>
<div class="line">      colorMapped_[led].b = color_[led].g * percent;</div>
<div class="line">      colorMapped_[led].r = color_[led].b * percent;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> BGR:</div>
<div class="line"> </div>
<div class="line">      colorMapped_[led].b = color_[led].r * percent;</div>
<div class="line">      colorMapped_[led].g = color_[led].g * percent;</div>
<div class="line">      colorMapped_[led].r = color_[led].b * percent;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">      </div>
<div class="line">    <span class="keywordflow">case</span> BRG:</div>
<div class="line"> </div>
<div class="line">      colorMapped_[led].b = color_[led].r * percent;</div>
<div class="line">      colorMapped_[led].r = color_[led].g * percent;</div>
<div class="line">      colorMapped_[led].g = color_[led].b * percent;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line"> </div>
<div class="line">      colorMapped_[led].r = color_[led].r * percent;</div>
<div class="line">      colorMapped_[led].g = color_[led].g * percent;</div>
<div class="line">      colorMapped_[led].b = color_[led].b * percent;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> percent;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">MyWS2812B ::MyWS2812B(<span class="keyword">volatile</span> uint8_t &amp;ddrx, <span class="keyword">volatile</span> uint8_t &amp;portx, uint8_t *sfr_mem_addr_portx, uint8_t pin_number, uint8_t max_number_of_leds, enum_colormapping color_mapping) : </div>
<div class="line">  ptrDataDirectionRegister_ (&amp;ddrx), </div>
<div class="line">  ptrPortRegister_ (&amp;portx), </div>
<div class="line">  ptrPortRegisterMemAddr_ (sfr_mem_addr_portx), </div>
<div class="line">  pin_ (pin_number),</div>
<div class="line">  colorMapping_ (color_mapping), </div>
<div class="line">  data_ {max_number_of_leds, new uint8_t[max_number_of_leds]},</div>
<div class="line">  color_ (new <a class="code hl_struct" href="structpod__rgb.html">pod_rgb</a>[max_number_of_leds]),</div>
<div class="line">  colorMapped_ (new <a class="code hl_struct" href="structpod__rgb.html">pod_rgb</a>[max_number_of_leds]) {</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Initialisiere die max anzahl von LEDS</span></div>
<div class="line">  <span class="comment">//data_.maxNumberOfLeds = max_number_of_leds;  </span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Initialisiere das Array mit der maximalen Anzahl von LEDs.</span></div>
<div class="line">  <span class="comment">//color_ = new pod_rgb[max_number_of_leds]; </span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Initialisiere das Array mit der maximalen Anzahl von LEDs.</span></div>
<div class="line">  <span class="comment">//colorMapped_ = new pod_rgb[max_number_of_leds]; </span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">//data_.brightness = new uint8_t[max_number_of_leds];</span></div>
<div class="line">  <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; max_number_of_leds; i++) {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// full brightness for all LEDs at the beginning</span></div>
<div class="line"> </div>
<div class="line">    data_.brightness[i] = 255;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">MyWS2812B ::~MyWS2812B() {</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Gib das Array-Speicherplatz beim Löschen des Objekts frei.</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">delete</span> [] color_; </div>
<div class="line">  <span class="keyword">delete</span> [] colorMapped_;</div>
<div class="line">  <span class="keyword">delete</span> [] data_.brightness;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyWS2812B ::setColor(uint8_t led, uint8_t r, uint8_t g, uint8_t b) {</div>
<div class="line">  </div>
<div class="line">  color_[led] = {r, g, b};</div>
<div class="line"> </div>
<div class="line">  calculateBrightness(data_.brightness[led], led);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyWS2812B ::setColor(uint8_t led, enum_colormodes mode) {</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Red: 255, 0, 0</span></div>
<div class="line">  <span class="comment">// Blue: 0, 0, 255</span></div>
<div class="line">  <span class="comment">// Yellow: 255, 255, 0</span></div>
<div class="line">  <span class="comment">// Green: 0, 255, 0</span></div>
<div class="line">  <span class="comment">// Orange: 255, 165, 0</span></div>
<div class="line">  <span class="comment">// Purple: 128, 0, 128</span></div>
<div class="line">  <span class="comment">// Pink: 255, 192, 203</span></div>
<div class="line">  <span class="comment">// Brown: 139, 69, 19</span></div>
<div class="line">  <span class="comment">// Black: 0, 0, 0</span></div>
<div class="line">  <span class="comment">// White: 255, 255, 255</span></div>
<div class="line">  <span class="comment">// Warm White: 255, 75, 15</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (mode) {</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> RED:</div>
<div class="line"> </div>
<div class="line">      color_[led] = {255, 0, 0};</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> BLUE:</div>
<div class="line"> </div>
<div class="line">      color_[led] = {0, 0, 255};</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> YELLOW:</div>
<div class="line"> </div>
<div class="line">      color_[led] = {255, 255, 0};</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> GREEN:</div>
<div class="line"> </div>
<div class="line">      color_[led] = {0, 255, 0};</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> ORANGE:</div>
<div class="line"> </div>
<div class="line">      color_[led] = {255, 165, 0};</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> PURPLE:</div>
<div class="line"> </div>
<div class="line">      color_[led] = {128, 0, 128};</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> PINK:</div>
<div class="line"> </div>
<div class="line">      color_[led] = {255, 192, 203};</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> BROWN:</div>
<div class="line"> </div>
<div class="line">      color_[led] = {139, 69, 19};</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> BLACK:</div>
<div class="line"> </div>
<div class="line">      color_[led] = {0, 0, 0};</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">case</span> WHITE:</div>
<div class="line"> </div>
<div class="line">      color_[led] = {255, 255, 255};</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> WARM_WHITE:</div>
<div class="line"> </div>
<div class="line">      color_[led] = {255, 75, 15};</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line"> </div>
<div class="line">      color_[led] = {255, 255, 255};</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  calculateBrightness(data_.brightness[led], led);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyWS2812B::setColor(uint8_t led, <a class="code hl_struct" href="structpod__rgb.html">pod_rgb</a> &amp;color) {</div>
<div class="line"> </div>
<div class="line">  setColor(led, color.<a id="a1" name="a1"></a>r, color.<a id="a2" name="a2"></a>g, color.<a id="a3" name="a3"></a>b);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyWS2812B ::setBrightness(uint8_t n, uint8_t led) {</div>
<div class="line"> </div>
<div class="line">  data_.brightness[led] = n;</div>
<div class="line">  calculateBrightness(n, led);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyWS2812B ::clearColor(uint8_t led) {</div>
<div class="line"> </div>
<div class="line">  color_[led].r = 0;</div>
<div class="line">  color_[led].g = 0;</div>
<div class="line">  color_[led].b = 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyWS2812B ::setColor(uint8_t r, uint8_t g, uint8_t b) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; data_.maxNumberOfLeds; i++) {</div>
<div class="line"> </div>
<div class="line">    setColor(i, r,g,b);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyWS2812B ::setColor(enum_colormodes mode) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; data_.maxNumberOfLeds; i++) {</div>
<div class="line"> </div>
<div class="line">    setColor(i, mode);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyWS2812B::setColor(<a class="code hl_struct" href="structpod__rgb.html">pod_rgb</a> &amp;color) {</div>
<div class="line"> </div>
<div class="line">  setColor(color.r, color.g, color.b);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyWS2812B ::setBrightness(uint8_t n) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (uint16_t led = 0; led &lt; data_.maxNumberOfLeds; led++) {</div>
<div class="line"> </div>
<div class="line">    data_.brightness[led] = n;</div>
<div class="line">    calculateBrightness(n, led);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyWS2812B ::clearColor() {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; data_.maxNumberOfLeds; i++) {</div>
<div class="line"> </div>
<div class="line">    setColor(i, 0,0,0);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyWS2812B ::show() {</div>
<div class="line"> </div>
<div class="line">  setLeds(colorMapped_, data_.maxNumberOfLeds);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structpod__rgb.html">pod_rgb</a> MyWS2812B ::getColor(uint8_t led) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> color_[led];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a id="_a4" name="_a4"></a><a class="code hl_struct" href="structpod__leddata.html">pod_leddata</a> MyWS2812B ::getLedsData() {</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> data_;</div>
<div class="line">}</div>
<div class="ttc" id="astructpod__leddata_html"><div class="ttname"><a href="structpod__leddata.html">pod_leddata</a></div><div class="ttdoc">this structure contains all informations about the led array</div><div class="ttdef"><b>Definition</b> MyNeoPixels.hpp:119</div></div>
<div class="ttc" id="astructpod__rgb_html"><div class="ttname"><a href="structpod__rgb.html">pod_rgb</a></div><div class="ttdoc">Structure of the LED array.</div><div class="ttdef"><b>Definition</b> MyNeoPixels.hpp:93</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
